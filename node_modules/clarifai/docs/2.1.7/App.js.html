<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>App.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="App.html">App</a><ul class='methods'><li data-type='method'><a href="App.html#getToken">getToken</a></li><li data-type='method'><a href="App.html#setToken">setToken</a></li></ul></li><li><a href="Concept.html">Concept</a><ul class='methods'><li data-type='method'><a href="Concept.html#toObject">toObject</a></li></ul></li><li><a href="Concepts.html">Concepts</a><ul class='methods'><li data-type='method'><a href="Concepts.html#create">create</a></li><li data-type='method'><a href="Concepts.html#get">get</a></li><li data-type='method'><a href="Concepts.html#list">list</a></li><li data-type='method'><a href="Concepts.html#search">search</a></li></ul></li><li><a href="Input.html">Input</a><ul class='methods'><li data-type='method'><a href="Input.html#deleteConcepts">deleteConcepts</a></li><li data-type='method'><a href="Input.html#mergeConcepts">mergeConcepts</a></li><li data-type='method'><a href="Input.html#toObject">toObject</a></li></ul></li><li><a href="Inputs.html">Inputs</a><ul class='methods'><li data-type='method'><a href="Inputs.html#create">create</a></li><li data-type='method'><a href="Inputs.html#delete">delete</a></li><li data-type='method'><a href="Inputs.html#deleteConcepts">deleteConcepts</a></li><li data-type='method'><a href="Inputs.html#get">get</a></li><li data-type='method'><a href="Inputs.html#getStatus">getStatus</a></li><li data-type='method'><a href="Inputs.html#list">list</a></li><li data-type='method'><a href="Inputs.html#mergeConcepts">mergeConcepts</a></li><li data-type='method'><a href="Inputs.html#search">search</a></li></ul></li><li><a href="Model.html">Model</a><ul class='methods'><li data-type='method'><a href="Model.html#deleteConcepts">deleteConcepts</a></li><li data-type='method'><a href="Model.html#getInputs">getInputs</a></li><li data-type='method'><a href="Model.html#getOutputInfo">getOutputInfo</a></li><li data-type='method'><a href="Model.html#getVersion">getVersion</a></li><li data-type='method'><a href="Model.html#getVersions">getVersions</a></li><li data-type='method'><a href="Model.html#mergeConcepts">mergeConcepts</a></li><li data-type='method'><a href="Model.html#predict">predict</a></li><li data-type='method'><a href="Model.html#toObject">toObject</a></li><li data-type='method'><a href="Model.html#train">train</a></li></ul></li><li><a href="Models.html">Models</a><ul class='methods'><li data-type='method'><a href="Models.html#create">create</a></li><li data-type='method'><a href="Models.html#delete">delete</a></li><li data-type='method'><a href="Models.html#get">get</a></li><li data-type='method'><a href="Models.html#initModel">initModel</a></li><li data-type='method'><a href="Models.html#list">list</a></li><li data-type='method'><a href="Models.html#predict">predict</a></li><li data-type='method'><a href="Models.html#search">search</a></li><li data-type='method'><a href="Models.html#train">train</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">App.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>let axios = require('axios');
let es6Promise = require('es6-promise');
let {Promise} = es6Promise;
let Models = require('./Models');
let Inputs = require('./Inputs');
let Concepts = require('./Concepts');
let constants = require('./constants');
let {API} = constants;
let {TOKEN_PATH} = API;


/**
* top-level class that allows access to models, inputs and concepts
* @class
*/
class App {
  constructor(clientId, clientSecret, options) {
    this._validate(clientId, clientSecret, options);
    this._init(clientId, clientSecret, options);
  }
  /**
  * Gets a token from the API using client credentials
  * @return {Promise(token, error)} A Promise that is fulfilled with the token string or rejected with an error
  */
  getToken() {
    return this._config.token();
  }
  /**
  * Sets the token to use for the API
  * @param {String}         _token    The token you are setting
  * @return {Boolean}                 true if token has valid fields, false if not
  */
  setToken(_token) {
    let token = _token;
    if (typeof _token === 'string') {
      token = {
        'access_token': _token,
        'expires_in': 176400
      };
    }
    if (token.access_token &amp;&amp; token.expires_in) {
      this._config['_token'] = token;
      return true;
    }
    return false;
  }
  _validate(clientId, clientSecret, options) {
    if (clientId === undefined || clientSecret === undefined) {
      throw new Error('Client ID and client secret is required');
    }
  }
  _init(clientId, clientSecret, options={}) {
    this._config = {
      'apiEndpoint': options.apiEndpoint ||
        (process &amp;&amp; process.env &amp;&amp; process.env.API_ENDPOINT) ||
        'https://api.clarifai.com',
      'clientId': clientId,
      'clientSecret': clientSecret,
      '_token': null,
      token: ()=> {
        return new Promise((resolve, reject)=> {
          let now = new Date().getTime();
          if (this._config._token !== null &amp;&amp; this._config._token.expireTime > now) {
            resolve(this._config._token);
          } else {
            this._getToken(resolve, reject);
          }
        });
      }
    };
    this.models = new Models(this._config);
    this.inputs = new Inputs(this._config);
    this.concepts = new Concepts(this._config);
  }
  _getToken(resolve, reject) {
    this._requestToken().then(
      (response)=> {
        if (response.status === 200) {
          let token = response.data;
          let now = new Date().getTime();
          token.expireTime = now + (token.expires_in * 1000);
          this.setToken(token);
          resolve(token);
        } else {
          reject(response);
        }
      },
      reject
    );
  }
  _requestToken() {
    let url = `${this._config['apiEndpoint']}${TOKEN_PATH}`;
    let clientId = this._config['clientId'];
    let clientSecret = this._config['clientSecret'];
    return axios({
      'url': url,
      'method': 'POST',
      'auth': {
        'username': clientId,
        'password': clientSecret
      }
    });
  }
};

module.exports = App;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.1</a> on Wed Oct 05 2016 12:33:14 GMT-0400 (EDT) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
